<section class="standings">
  @if (loading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading championship standings...</p>
    </div>
  }

  @if (error()) {
    <mat-card class="error-card">
      <mat-card-content>
        <p class="error-message">{{ error() }}</p>
      </mat-card-content>
    </mat-card>
  }

  @if (!loading() && !error() && driverStandings().length > 0) {
    <div class="drivers-container">
      @if (filteredStandings().length === 0) {
        <mat-card class="no-results-card">
          <mat-card-content>
            <p>No drivers match your search.</p>
          </mat-card-content>
        </mat-card>
      } @else {
        <mat-accordion>
          @for (standing of filteredStandings(); track standing.Driver.driverId; let i = $index) {
            <app-driver-standing-card
              [standing]="standing"
              [expanded]="step() === i"
              [countryFlag]="getCountryFlag(standing.Driver.nationality)"
              [teamColor]="getTeamColor(standing)"
              [probability]="getChampionshipProbability(standing)"
              [probabilityTooltip]="getProbabilityTooltip(standing)"
              [isFirst]="step() === 0"
              [isLast]="step() === filteredStandings().length - 1"
              [allStandings]="driverStandings()"
              [teamColors]="teamColors()"
              (opened)="setStep(i)"
              (previous)="prevStep()"
              (next)="nextStep()"
            />
          }
        </mat-accordion>
      }
    </div>
  }

  @if (!loading() && !error() && driverStandings().length === 0) {
    <mat-card>
      <mat-card-content>
        <p class="no-data-message">No championship data available at the moment.</p>
      </mat-card-content>
    </mat-card>
  }
</section>
